\iffalse
Author: Kacper Gawroński

This file is part of Project Framework.

Project Framework is free software: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Project Framework is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Project Framework. If not, see
https://www.gnu.org/licenses/
\fi

\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\title{Documentation\newline for Project Framework}
\author{Kacper Gawroński}
\begin{document}
\maketitle
\section{Introduction}
Source files can be found on https://github.com/KacperGawronski/project\_framework .\newline
Project started as example usage of socket.h.\\
Next step was implementing handling of http request using Lua scripting
language. When it was done, I noticed that it can script page generation
structure and handle all requests. Project is on GNU GPL license, 
however, some external libraries might be on other licenses.
\section{Dependencies}
Basic project require:\\
\begin{itemize}
\item{POSIX compiliant system} Basically project is targeted on GNU/Linux
OS - Debian.
\item{Lua5.3 libraries and headers}
\end{itemize}
Example worker also require:
\begin{itemize}
\item{MariaDB dev files (C connector)}
\item{jansson library and header files} for database api
\end{itemize}
To run example project it is also required to have MariaDB installed,
with example database from:\newline
https://github.com/datacharmer/test\_db\newline
installation process can be found on:\newline
https://www.ibm.com/developerworks/library/l-lpic1-105-3/index.html
\newpage
\section{Structure}
\subsection{webserver.c}
webserver.c contains code that allow handling connections.
It makes listening socket (by default on port 9090), and forwards
accepted connections to threads based on worker function. It passes
struct stack\_element, taken from initialized stack, containing all
required data to process connection. When connection is done, structure
is pushed back on the stack by thread for further use.\\
By default, threre is limitation 100 for number of threads, it's
controlled by semaphore.
\subsection{worker.c}
function worker() handles connections. It reads sent data (by default
only 10240 bytes), initializes Lua library as interpreter, and pushes
on it additional C functions.\\
Example of adding C function to Lua scripting level:\newline
\begin{verbatim}
		lua_pushcfunction(L,generate_menu);
		lua_setglobal(L,"generate_menu");
\end{verbatim}
Function should be defined as:\\
\begin{verbatim}
	int name(lua_State * L){ (...) return number_of_returned_values }
\end{verbatim}
Example functions are placed in menu.c and mariadb\_connector.c files.
\newpage
\subsection{Page structure}
\paragraph{Example page} is described in following files:
\begin{itemize}
	\item{example.lua}\newline\indent Placed in app/pages directory.
File contains page description - header definitions, javascript files to
use and body
	\item{example.js}\newline\indent Placed in app/javascript directory.
File contains javascript which is run on page load.
	\item{style.css}\newline\indent Global css file placed in app/css
directory.
	\item{api.lua}\newline\indent File describing json api, as for
api.json?[smth] requests.
	\item{page\_template.lua} File placed in app directory. It is used
for processing every lua file in app/pages directory. 
It contains page structure definition.
\end{itemize}
\paragraph{Generally}
	\begin{itemize}
		\item{worker} directory contains basic files for processing and 
handling requests - especially forwarding them to Lua interpreter.
		\item{app} directory contains definitions of what should be done
with request.
		\item{app/GET.lua} Main file for processing GET request. It
describes actions taken on specific GET requests. In this project, for
example, it does file app/pages/filename.lua for request like
"/page?filename"
		\item{app/page\_template.lua} returns function which should be done
by every page using definied table as argument.
		\item{app/pages} directory contains files describing pages, in
format definied by page\_template.lua code.
		\item{app/pages/pagename.lua} is file describing pagename site.
It should define table as used by page\_template.lua. Link to it will be
generated by generate\_menu() function as page?pagename . 
To add link in html you should simple write page?filename without
extension (it will be added in code, prevents a little from hacking).
		\item{app/javascript} is main directory for javascript .js files.
It won't automatically include js for every page, it needs to be definied
in page file.
		\item{app/css} directory contains css files, and description of
files included in every page in requires.txt.
		\item{json.api} contains file api.lua, which is called on GET
/api.json?[smth] request. It is example of additional aplication.
	\end{itemize}

\end{document}
